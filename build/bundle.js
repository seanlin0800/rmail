webpackJsonp([0],{0:function(e,t,n){"use strict";var i=n(2),a=n(153),s=n(215),r=n(1);n(333),n(342),r.init(),s.getBoxData(),a.run(function(e){i.render(i.createElement(e),document.getElementById("app"))})},1:function(e,t){"use strict";e.exports={init:function(){sessionStorage.mails||sessionStorage.setItem("mails",JSON.stringify([{id:1,name:"inbox",emails:[{id:1,from:"alice@rmail.com",to:"seanlin0800@rmail.com",subject:"Greeting",body:"Just wanna say hi.",isRead:!1,isStarred:!1,date:"2014-12-29T04:44:44Z"},{id:2,from:"react@facebook.com",to:"seanlin0800@rmail.com",subject:"News Digest",body:'<h1>Awesome React</h1> <img src="https://raw.githubusercontent.com/wiki/facebook/react/react-logo-1000-transparent.png" width=300/)>',isRead:!1,isStarred:!1,date:"2015-04-25T04:44:44Z"},{id:3,from:"admin@github.com",to:"seanlin0800@rmail.com",subject:"Welcome to Github",body:"Welcome!! Thanks for signing up with Github.",isRead:!1,isStarred:!1,date:(new Date).toISOString()}]},{id:2,name:"spam",emails:[{id:3,from:"richdad@gmail.com",to:"seanlin0800@rmail.com",subject:"Want to Be Rich?",body:"Have you ever dreamed of being a millionaire? Here're some secrets rich people don't want you to know.",isRead:!1,isStarred:!1,date:"2015-07-04T16:44:44Z"}]},{id:3,name:"sent",emails:[]}]))}}},153:function(e,t,n){"use strict";var i,a,s;e.exports={makePath:function(e,t,n){return s.makePath(e,t,n)},makeHref:function(e,t,n){return s.makeHref(e,t,n)},transitionTo:function(e,t,n){s.transitionTo(e,t,n)},replaceWith:function(e,t,n){s.replaceWith(e,t,n)},goBack:function(){s.goBack()},run:function(e){s.run(e)}},i=n(154),a=n(193),s=i.create({routes:a,location:i.HashLocation})},193:function(e,t,n){"use strict";var i=n(2),a=n(154),s=a.Route,r=a.DefaultRoute,o=n(312),c=n(194),l=n(331),m=n(332),u=i.createElement(s,{name:"app",path:"/",handler:o},i.createElement(s,{name:"mailboxes",path:"/:name",handler:c}),i.createElement(s,{name:"mails",path:"/:name/:id",handler:l}),i.createElement(r,{handler:m.create("box")}));e.exports=u},194:function(e,t,n){"use strict";var i=n(2),a=n(154),s=n(196),r=n(198),o=(n(195),n(200)),c=n(218),l=n(305),m=i.createClass({displayName:"Mailbox",mixins:[a.State,s],getInitialState:function(){return this._getStateFromStores(this.getParams().name)},componentDidMount:function(){this.listenTo(o,this._onChange)},componentWillReceiveProps:function(e){this.setState(this._getStateFromStores(e.params.name))},_getStateFromStores:function(e){var t=o.getBox(e);return{emails:t.emails}},_onChange:function(){this.setState(this._getStateFromStores(this.getParams().name))},render:function(){var e=this.getParams().name;return i.createElement(r,{title:c.formatBoxName(e)},i.createElement("div",null,i.createElement(l,{emails:this.state.emails,boxName:this.getParams().name})))}});e.exports=m},195:function(e,t){"use strict";e.exports={TITLE:"Rmail",USER:"seanlin0800@rmail.com"}},196:function(e,t,n){"use strict";var i=n(197),a={componentWillMount:function(){i.create(this)},componentWillUnmount:function(){i.destroy(this)},listenTo:function(e,t){i.add(this,e,t)},listenToMany:function(e,t){e.forEach(function(e){this.listenTo(e,t)},this)},getListeners:function(){return i.listeners(this)}};e.exports=a},197:function(e,t){"use strict";var n={create:function(e){e._AltMixinRegistry=e._AltMixinRegistry||[]},add:function(e,t,n){e._AltMixinRegistry.push(t.listen(n))},destroy:function(e){e._AltMixinRegistry.forEach(function(e){e()}),e._AltMixinRegistry=[]},listeners:function(e){return e._AltMixinRegistry}};e.exports=n},200:function(e,t,n){"use strict";function i(){this.bindActions(s),this.bindActions(r),this.mailData={},this.exportPublicMethods({getAll:function(){return this.getState().mailData},getBox:function(e){return this.getState().mailData[e]},get:function(e,t){return this.getState().mailData[e].emails[parseInt(t,10)]}})}var a=n(201),s=n(214),r=n(217);i.prototype.onReceiveAll=function(e){var t,n=null,i=e.length;for(t=0;i>t;t++)n=e[t],this.mailData[n.name]||(this.mailData[n.name]=this._convert(n))},i.prototype.onMarkThread=function(e){this._markThread(e)},i.prototype.onDelete=function(e){delete this.mailData[e.name].emails[e.id]},i.prototype.onClickStar=function(e){var t=this._get(this.mailData,e.name,e.id);t.isStarred=!e.val},i.prototype.onSendMailSuccess=function(e){this.mailData.sent.emails[e.id]=e},i.prototype._markThread=function(e){var t=this._get(this.mailData,e.name,e.id);t.isRead=e.val},i.prototype._convert=function(e){return{id:e.id,name:e.name,emails:this._toObj(e.emails)}},i.prototype._toObj=function(e){var t,n={},i=e.length;for(t=0;i>t;t++)n[e[t].id]=e[t];return n},i.prototype._get=function(e,t,n){return e[t].emails[n]},e.exports=a.createStore(i,"EmailStore")},201:function(e,t,n){"use strict";var i=n(202),a=new i;e.exports=a},214:function(e,t,n){"use strict";function i(){this.markThread=function(e,t,n){this.dispatch({name:e,id:t,val:n}),s.updateMail(e,parseInt(t,10),{isRead:n})},this["delete"]=function(e,t){this.dispatch({name:e,id:t}),s.deleteEmail(e,parseInt(t,10))},this.clickStar=function(e){s.updateMail(e.name,parseInt(e.id,10),{isStarred:!e.val}),this.dispatch(e)}}var a=n(201),s=n(215);e.exports=a.createActions(i)},215:function(e,t,n){"use strict";function i(){return JSON.parse(sessionStorage.getItem("mails"))}function a(e){sessionStorage.setItem("mails",JSON.stringify(e))}function s(e,t){var n,i=e.length;for(n=0;i>n;n++)if(t===e[n].name)return e[n];return{}}function r(e){var t=i(),n=s(t,"sent"),r=0;return n.emails.length>0&&(r=n.emails.slice(-1)[0].id+1),e.id=r,n.emails.push(e),a(t),r}var o=n(216),c=n(217);e.exports={getBoxData:function(){var e=i();c.receiveAll(e)},getEmail:function(e,t,n){var i,a=s(e,t),r=a.emails.length;for(i=0;r>i;i++)if(n===a.emails[i].id)return a.emails[i];return{}},updateMail:function(e,t,n){var s=i(),r=this.getEmail(s,e,t);o(r,n),a(s)},deleteEmail:function(e,t){var n,r=i(),o=s(r,e),c=o.emails.length;for(n=0;c>n;n++)if(t===o.emails[n].id)return o.emails.splice(n,1),void a(r)},sendMail:function(e){e.id=r(o({},e)),setTimeout(function(){c.sendMailSuccess(e)},0)}}},217:function(e,t,n){"use strict";function i(){this.generateActions("receiveAll","sendMailSuccess")}var a=n(201);e.exports=a.createActions(i)},218:function(e,t,n){"use strict";var i=n(219),a={inbox:"Inbox",spam:"Spam",sent:"Sent Mail"};e.exports={formatBoxName:function(e){return a[e]},formatDate:function(e){var t=i(e),n=i();return n.isSame(t,"day")?t.format("h:mm a"):n.isSame(t,"year")?t.format("MMM DD"):t.format("YYYY/MM/DD")}}},305:function(e,t,n){"use strict";var i=n(2),a=n(196),s=n(306),r=n(308),o=n(309),c=i.createClass({displayName:"EmailList",propTypes:{boxName:i.PropTypes.string,emails:i.PropTypes.object},mixins:[a],getInitialState:function(){return this._getStateFromStores()},componentDidMount:function(){this.listenTo(s,this._onChange)},_getStateFromStores:function(){return{isMenuActive:s.isMenuActive(),menuState:s.getMenuState()}},_renderContextMenu:function(){var e=null,t=this.props.emails;return this.state.isMenuActive&&(e=i.createElement(r,{boxName:this.props.boxName,status:this.state.menuState,mail:t[this.state.menuState.id]})),e},_onChange:function(){this.setState(this._getStateFromStores())},render:function(){var e=this.props.emails,t=Object.keys(e).sort(function(e,t){return t-e}),n=t.map(function(t){return i.createElement(o,{key:t,id:t,mail:e[t],boxName:this.props.boxName})}.bind(this));return i.createElement("table",{className:"email-list table"},i.createElement("tbody",null,n),this._renderContextMenu())}});e.exports=c},306:function(e,t,n){"use strict";function i(){this.bindActions(r),this.isActive=!1,this.menuState={xPos:0,yPos:0,id:-1},this.exportPublicMethods({isMenuActive:function(){return this.getState().isActive},getMenuState:function(){return this.getState().menuState}})}var a=n(201),s=n(216),r=n(307);i.prototype.onShowMenu=function(e){this.isActive=!0,s(this.menuState,e)},i.prototype.onHideMenu=function(){this.isActive=!1},e.exports=a.createStore(i,"ContextMenuStore")},307:function(e,t,n){"use strict";function i(){this.generateActions("showMenu","hideMenu")}var a=n(201);e.exports=a.createActions(i)},308:function(e,t,n){"use strict";var i=n(2),a=n(214),s=n(307),r=function(e){return function(t){t.stopPropagation(),t.preventDefault(),e(),s.hideMenu()}},o=i.createClass({displayName:"ContextMenu",propTypes:{boxName:i.PropTypes.string,status:i.PropTypes.object,mail:i.PropTypes.object},_markThread:function(){a.markThread(this.props.boxName,this.props.status.id,!this.props.mail.isRead)},_delete:function(){a["delete"](this.props.boxName,this.props.status.id)},render:function(){var e={left:this.props.status.xPos,top:this.props.status.yPos};return i.createElement("div",{className:"context-menu open",style:e},i.createElement("ul",{className:"dropdown-menu"},i.createElement("li",null,i.createElement("a",{href:"#",onClick:r(this._markThread)},"Mark as ",this.props.mail.isRead?"unread":"read")),i.createElement("li",null,i.createElement("a",{href:"#",onClick:r(this._delete)},i.createElement("span",{className:"glyphicon glyphicon-trash"})," Delete"))))}});e.exports=o},309:function(e,t,n){"use strict";var i=n(2),a=n(154),s=n(310),r=n(218),o=n(307),c=n(311),l=i.createClass({displayName:"EmailListItem",propTypes:{mail:i.PropTypes.object,id:i.PropTypes.string,boxName:i.PropTypes.string},mixins:[a.Navigation],_clickThread:function(){this.transitionTo("mails",{name:this.props.boxName,id:this.props.id})},_showContextMenu:function(e){e.preventDefault(),o.showMenu({xPos:e.clientX,yPos:e.clientY,id:this.props.id})},render:function(){var e=s({"mail-item":!0,active:this.props.mail.isRead}),t=s({unread:!this.props.mail.isRead,read:this.props.mail.isRead}),n=this.props.mail.isStarred?"Starred":"Not starred";return i.createElement("tr",{className:e,onClick:this._clickThread,onContextMenu:this._showContextMenu},i.createElement("td",{className:"bg"}),i.createElement("td",{className:"widget",title:n},i.createElement(c,{mail:this.props.mail,boxName:this.props.boxName})),i.createElement("td",{className:"from"},i.createElement("span",{className:t},this.props.mail.from)),i.createElement("td",null,i.createElement("span",{className:t},this.props.mail.subject)," - ",this.props.mail.body.substring(0,50)),i.createElement("td",null,i.createElement("span",{className:t},r.formatDate(this.props.mail.date))))}});e.exports=l},311:function(e,t,n){"use strict";var i=n(2),a=n(310),s=n(214),r=i.createClass({displayName:"StarWidget",propTypes:{mail:i.PropTypes.object,boxName:i.PropTypes.string},_clickHandler:function(e){e.stopPropagation(),s.clickStar({name:this.props.boxName,id:this.props.mail.id,val:this.props.mail.isStarred})},render:function(){var e=a({star:!0,"star-lit":this.props.mail.isStarred,"star-normal":!this.props.mail.isStarred});return i.createElement("div",{className:e,onClick:this._clickHandler}," ")}});e.exports=r},312:function(e,t,n){"use strict";var i=n(2),a=n(198),s=n(307),r=n(306),o=n(313),c=n(318),l=n(326),m=n(330),u=n(195),d=i.createClass({displayName:"Main",_handleClick:function(){r.isMenuActive()&&s.hideMenu()},render:function(){return i.createElement(a,{title:u.TITLE},i.createElement("div",{className:"main",onClick:this._handleClick},i.createElement("div",{className:"container"},i.createElement("div",{className:"row"},i.createElement(l,null),i.createElement(m,null))),i.createElement(o,null),i.createElement(c,null)))}});e.exports=d},313:function(e,t,n){"use strict";var i=n(2),a=n(196),s=n(314),r=n(316),o=i.createClass({displayName:"NewMsgBox",mixins:[a],getInitialState:function(){return this._getStateFromStores()},componentDidMount:function(){this.listenTo(s,this._onChange)},_renderBoxList:function(){var e=this.state.boxKeyList,t=e.length-2;return e.map(function(e,n){return i.createElement(r,{key:e,id:e,isHidden:t>n})})},_getStateFromStores:function(){return{boxKeyList:s.getNewMsgKeys()}},_onChange:function(){this.setState(this._getStateFromStores())},render:function(){return i.createElement("div",{className:"new-message"},this._renderBoxList())}});e.exports=o},314:function(e,t,n){"use strict";function i(){this.bindActions(s),this.newMsgBoxes={},this.newMsgBoxId=0,this.exportPublicMethods({getNewMsgKeys:function(){return Object.keys(this.getState().newMsgBoxes)}})}var a=n(201),s=n(315);i.prototype.onAddNewMsgBox=function(){this.newMsgBoxes[this.newMsgBoxId++]=1},i.prototype.onDelNewMsgBox=function(e){delete this.newMsgBoxes[e]},e.exports=a.createStore(i,"MsgBoxStore")},315:function(e,t,n){"use strict";function i(){this.generateActions("addNewMsgBox","delNewMsgBox"),this.sendMail=function(e){e.date=(new Date).toISOString(),this.dispatch(),s.sendMail(e)}}var a=n(201),s=n(215);e.exports=a.createActions(i)},316:function(e,t,n){"use strict";var i=n(2),a=n(310),s=n(315),r=n(317),o="New Message",c=i.createClass({displayName:"Model",propTypes:{id:i.PropTypes.number,isHidden:i.PropTypes["boolean"]},getInitialState:function(){return{title:o}},_handleClose:function(){s.delNewMsgBox(this.props.id)},_updateTitle:function(e){this.setState({title:e||o})},_send:function(){s.sendMail(this.refs.form.getInpuValues()),this._handleClose()},render:function(){var e=a({"modal-dialog":!0,box:!0,hidden:this.props.isHidden});return i.createElement("div",{className:e},i.createElement("div",{className:"modal-content"},i.createElement("div",{className:"modal-header"},i.createElement("button",{type:"button",className:"close",onClick:this._handleClose,"aria-label":"Close"},i.createElement("span",{"aria-hidden":"true"},"×")),i.createElement("h4",{className:"modal-title"},this.state.title)),i.createElement("div",{className:"modal-body"},i.createElement(r,{updateHandler:this._updateTitle,ref:"form"})),i.createElement("div",{className:"modal-footer"},i.createElement("button",{type:"button",className:"btn btn-primary",onClick:this._send},"Send"))))}});e.exports=c},317:function(e,t,n){"use strict";var i=n(2),a=n(195),s=i.createClass({displayName:"NewMsgForm",propTypes:{updateHandler:i.PropTypes.func},getInpuValues:function(){var e=i.findDOMNode(this.refs.recipient).value.trim(),t=i.findDOMNode(this.refs.subject).value.trim(),n=i.findDOMNode(this.refs.message).value.trim();return i.findDOMNode(this.refs.recipient).value="",i.findDOMNode(this.refs.subject).value="",i.findDOMNode(this.refs.message).value="",{from:a.USER,to:e,subject:t,body:n}},_update:function(e){this.props.updateHandler(e.target.value)},render:function(){return i.createElement("form",null,i.createElement("div",{className:"form-group"},i.createElement("label",{htmlFor:"recipient",className:"control-label"},"Recipient:"),i.createElement("input",{type:"text",className:"form-control",id:"recipient",ref:"recipient"})),i.createElement("div",{className:"form-group"},i.createElement("label",{htmlFor:"subject",className:"control-label"},"Subject:"),i.createElement("input",{type:"text",className:"form-control",id:"subject",ref:"subject",onBlur:this._update})),i.createElement("div",{className:"form-group"},i.createElement("label",{htmlFor:"message",className:"control-label"},"Message:"),i.createElement("textarea",{className:"form-control",id:"message",rows:"5",ref:"message"})))}});e.exports=s},318:function(e,t,n){"use strict";var i=n(2),a=n(196),s=n(319),r=n(325),o=i.createClass({displayName:"NotificationBox",mixins:[a],componentDidMount:function(){this.listenTo(r,this._onChange)},_onChange:function(){var e={message:r.getMessage(),position:"tc",level:"success",action:r.getAction()};this.refs.notificationSystem.addNotification(e)},render:function(){return i.createElement("div",null,i.createElement(s,{ref:"notificationSystem"}))}});e.exports=o},325:function(e,t,n){"use strict";function i(){this.bindActions(r),this.message="",this.action={},this.exportPublicMethods({getMessage:function(){return this.getState().message},getAction:function(){return this.getState().action}})}var a=n(201),s=n(153),r=n(217),o=n(200);i.prototype.onSendMailSuccess=function(e){this.waitFor([o.dispatchToken]),this.message="Your message has been sent",this.action={label:"View message",callback:function(){s.transitionTo("mails",{name:"sent",id:e.id})}}},e.exports=a.createStore(i,"NotificationStore")},326:function(e,t,n){"use strict";var i=n(2),a=n(315),s=n(327),r=i.createClass({displayName:"Sidebar",_clickCompose:function(){a.addNewMsgBox()},render:function(){return i.createElement("div",{className:"col-md-2 sidebar"},i.createElement("button",{type:"button",className:"btn btn-primary btn-block",onClick:this._clickCompose},"COMPOSE"),i.createElement(s,null))}});e.exports=r},327:function(e,t,n){"use strict";var i=n(2),a=n(196),s=n(328),r=n(329),o=i.createClass({displayName:"MailboxList",mixins:[a],getInitialState:function(){return this._getStateFromStores()},componentDidMount:function(){this.listenTo(s,this._onChange)},_getStateFromStores:function(){return{mailboxes:s.getAll()}},_onChange:function(){this.setState(this._getStateFromStores())},render:function(){var e=Object.keys(this.state.mailboxes).map(function(e){return i.createElement(r,{key:this.state.mailboxes[e].id,name:e,unreadCount:this.state.mailboxes[e].unreadCount})}.bind(this));return i.createElement("div",{className:"mailbox-list"},i.createElement("ul",{className:"list-group"},e))}});e.exports=o},328:function(e,t,n){"use strict";function i(){this.bindActions(s),this.bindActions(r),this.boxData={},this.exportPublicMethods({getAll:function(){return this.getState().boxData},get:function(e){return this.getState().boxData[e]}})}var a=n(201),s=n(214),r=n(217),o=n(200);i.prototype.onReceiveAll=function(){var e,t,n;this.waitFor([o.dispatchToken]),e=o.getAll();for(t in e)e.hasOwnProperty(t)&&(n=e[t],this.boxData[n.name]||(this.boxData[n.name]=this._convert(n)))},i.prototype.onMarkThread=function(e){this._updateCount(e.name)},i.prototype.onDelete=function(e){this._updateCount(e.name)},i.prototype.onSendMailSuccess=function(){this._updateCount("sent")},i.prototype._convert=function(e){return{id:e.id,unreadCount:this._getUnreadCount(e.emails)}},i.prototype._updateCount=function(e){var t;this.waitFor([o.dispatchToken]),t=o.getBox(e),this.boxData[e].unreadCount=this._getUnreadCount(t.emails)},i.prototype._getUnreadCount=function(e){return Object.keys(e).reduce(function(t,n){return e[n].isRead?t:t+1},0)},e.exports=a.createStore(i,"BoxStore")},329:function(e,t,n){"use strict";var i=n(2),a=n(154),s=n(310),r=n(218),o=i.createClass({displayName:"MailboxTab",propTypes:{name:i.PropTypes.string,unreadCount:i.PropTypes.number},mixins:[a.State,a.Navigation],_handleClick:function(){this.transitionTo("mailboxes",{name:this.props.name})},render:function(){var e=s({"list-group-item":!0,active:this.getParams().name===this.props.name});return i.createElement("li",{className:e,onClick:this._handleClick},i.createElement("span",{className:"badge"},this.props.unreadCount),r.formatBoxName(this.props.name))}});e.exports=o},330:function(e,t,n){"use strict";var i=n(2),a=n(154),s=a.RouteHandler,r=i.createClass({displayName:"Section",render:function(){return i.createElement("div",{className:"mailbox col-md-10"},i.createElement("div",{className:"panel panel-default"},i.createElement("div",{className:"panel-body"},i.createElement(s,null))))}});e.exports=r},331:function(e,t,n){"use strict";var i=n(2),a=n(154),s=n(196),r=n(198),o=(n(195),n(218)),c=n(214),l=n(200),m=n(311),u=i.createClass({displayName:"Email",propTypes:{mail:i.PropTypes.object},mixins:[a.State,s],getInitialState:function(){var e=this.getParams().id,t=this.getParams().name;return this._getStateFromStores(t,e)},componentDidMount:function(){this.listenTo(l,this._onChange),this._markRead()},componentWillReceiveProps:function(e){var t=e.params.id,n=e.params.name;this.setState(this._getStateFromStores(n,t))},componentDidUpdate:function(){this._markRead()},_getStateFromStores:function(e,t){return{mail:l.get(e,t)}},_markRead:function(){this.state.mail&&!this.state.mail.isRead&&c.markThread(this.getParams().name,this.getParams().id,!0)},_onChange:function(){this.setState(this._getStateFromStores(this.getParams().name,this.getParams().id))},render:function(){var e=this.state.mail;return e?i.createElement(r,{title:this.state.mail.subject},i.createElement("div",null,i.createElement("h2",null,e.subject),i.createElement("div",{className:"email"},i.createElement("div",{className:"row"},i.createElement("div",{className:"col-md-10"},e.from),i.createElement("div",{className:"col-md-2"},i.createElement(m,{mail:this.state.mail,boxName:this.getParams().name}),o.formatDate(e.date))),i.createElement("div",{className:"to"},"to ",e.to)),i.createElement("div",{className:"body",dangerouslySetInnerHTML:{__html:e.body}}))):null}});e.exports=u},332:function(e,t,n){"use strict";var i=n(2),a={create:function(e){return i.createClass({render:function(){return i.createElement("div",{className:"none-selected alert alert-warning",role:"alert"},i.createElement("span",null,"No ",e," selected."))}})}};e.exports=a},333:function(e,t){},342:function(e,t){}});