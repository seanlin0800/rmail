webpackJsonp([0],{0:function(e,t,n){"use strict";var i=n(1),a=n(152),s=n(212),r=n(488);n(489),n(498),n(500),r.init(),s.getBoxData(),s.auth(JSON.parse(sessionStorage.getItem("user"))),a.run(function(e){i.render(i.createElement(e),document.getElementById("app"))})},152:function(e,t,n){"use strict";var i,a,s;e.exports={makePath:function(e,t,n){return s.makePath(e,t,n)},makeHref:function(e,t,n){return s.makeHref(e,t,n)},transitionTo:function(e,t,n){s.transitionTo(e,t,n)},replaceWith:function(e,t,n){s.replaceWith(e,t,n)},goBack:function(){s.goBack()},run:function(e){s.run(e)}},i=n(153),a=n(192),s=i.create({routes:a,location:i.HashLocation})},192:function(e,t,n){"use strict";var i=n(1),a=n(153),s=a.Route,r=a.DefaultRoute,o=n(468),c=n(475),l=n(193),u=n(477),m=n(486),d=n(487),h=i.createElement(s,{name:"app",path:"/",handler:o},i.createElement(s,{name:"login",path:"/login",handler:c}),i.createElement(s,{name:"main",path:"/mail",handler:l},i.createElement(s,{name:"mailboxes",path:"/mail/:name",handler:u}),i.createElement(s,{name:"mails",path:"/mail/:name/:id",handler:m}),i.createElement(r,{handler:d.create("box")})),i.createElement(r,{handler:c}));e.exports=h},193:function(e,t,n){"use strict";var i=n(1),a=n(194),s=n(208),r=n(214),o=n(223),c=n(232),l=n(323),u=n(324),m=n(236),d=i.createClass({displayName:"Main",statics:{willTransitionTo:function(e){m.isAuth()||e.redirect("/login",{},{nextPath:e.path})}},_handleClick:function(){s.isMenuActive()&&a.hideMenu()},render:function(){return i.createElement("div",{className:"main",onClick:this._handleClick},i.createElement(u,null),i.createElement("div",{className:"container"},i.createElement("div",{className:"row"},i.createElement(c,null),i.createElement(l,null))),i.createElement(r,null),i.createElement(o,null))}});e.exports=d},194:function(e,t,n){"use strict";function i(){this.generateActions("showMenu","hideMenu")}var a=n(195);e.exports=a.createActions(i)},195:function(e,t,n){"use strict";var i=n(196),a=new i;e.exports=a},208:function(e,t,n){"use strict";function i(){this.bindActions(o),this.isActive=!1,this.menuState={xPos:0,yPos:0,id:-1},this.exportPublicMethods({isMenuActive:function(){return this.getState().isActive},getMenuState:function(){return this.getState().menuState}})}var a=n(195),s=n(209),r=n(210),o=n(194);i.prototype.onShowMenu=function(e){this.waitFor([r.dispatchToken]),this.isActive=!0,s(this.menuState,e)},i.prototype.onHideMenu=function(){this.isActive=!1},e.exports=a.createStore(i,"ContextMenuStore")},210:function(e,t,n){"use strict";function i(){this.bindActions(s),this.bindActions(r),this.checkedMails={inbox:{},spam:{},sent:{}},this.exportPublicMethods({isChecked:function(e,t){return t in this.getState().checkedMails[e]},getCheckedMails:function(e){return Object.keys(this.getState().checkedMails[e])}})}var a=n(195),s=n(211),r=n(194);i.prototype.onAddCheck=function(e){var t,n,i=this.checkedMails[e.name],a=e.mailList.length;if(1>a)return!1;for(n=0;a>n;n++)t=e.mailList[n],t.isChecked?i[t.id]=!0:delete i[t.id]},i.prototype.onShowMenu=function(e){var t=this.checkedMails[e.name];return e.id in t?!1:(this.checkedMails[e.name]={},void(this.checkedMails[e.name][e.id]=!0))},i.prototype.onDelete=function(e){var t=this.checkedMails[e.name];return!e.id in t?!1:void delete t[e.id]},e.exports=a.createStore(i,"CheckedEmailStore")},211:function(e,t,n){"use strict";function i(){this.markThread=function(e){s.updateMail(e.name,parseInt(e.id,10),{isRead:e.val}),this.dispatch(e)},this.markAll=function(e){s.markAll(e),this.dispatch(e)},this["delete"]=function(e){s.deleteEmail(e.name,parseInt(e.id,10)),this.dispatch(e)},this.clickStar=function(e){s.updateMail(e.name,parseInt(e.id,10),{isStarred:e.val}),this.dispatch(e)},this.addCheck=function(e){this.dispatch(e)},this.check=function(e){this.dispatch(e)}}var a=n(195),s=n(212);e.exports=a.createActions(i)},212:function(e,t,n){"use strict";function i(e){setTimeout(e,500)}function a(){return JSON.parse(sessionStorage.getItem("mails"))}function s(e){sessionStorage.setItem("mails",JSON.stringify(e))}function r(e,t){var n,i=e.length;for(n=0;i>n;n++)if(t===e[n].name)return e[n];return{}}function o(e){var t=a(),n=r(t,"sent"),i=0;return n.emails.length>0&&(i=n.emails.slice(-1)[0].id+1),e.id=i,n.emails.push(e),s(t),i}function c(e){var t=Math.random().toString(36).substring(7),n={};return n[e]=t,sessionStorage.setItem("server_user",JSON.stringify(n)),t}function l(e){var t=JSON.parse(sessionStorage.getItem("server_user"));return t&&t[e.user]===e.token?!0:!1}function u(e){var t=JSON.parse(sessionStorage.getItem("server_user"));delete t[e],sessionStorage.setItem("server_user",JSON.stringify(t))}var m=n(209),d=n(213),h=n(152);e.exports={getBoxData:function(){var e=a();d.receiveAll(e)},getEmail:function(e,t,n){var i,a=r(e,t),s=a.emails.length;for(i=0;s>i;i++)if(n===a.emails[i].id)return a.emails[i];return{}},updateMail:function(e,t,n){var i=a(),r=this.getEmail(i,e,t);m(r,n),s(i)},markAll:function(e){var t,n=a(),o=r(n,e.name),c=o.emails.length,l=0;for(t=0;c>t;t++)o.emails[t].isRead!==e.val&&(o.emails[t].isRead=e.val,l++);l>0?(s(n),i(function(){d.markAllSuccess(l)})):i(function(){d.markAllCanceled()})},deleteEmail:function(e,t){var n,i=a(),o=r(i,e),c=o.emails.length;for(n=0;c>n;n++)if(t===o.emails[n].id)return o.emails.splice(n,1),void s(i)},auth:function(e){return d.auth(),e&&l(e)?void i(function(){d.authSuccess(e)}):void i(function(){d.authError(e)})},sendMail:function(e){e.id=o(m({},e)),i(function(){d.sendMailSuccess(e)})},login:function(e){var t;return"seanlin0800@rmail.com"!==e.email||"pass"!==e.password?void i(function(){d.loginError()}):(t=c(e.email),void i(function(){d.loginSuccess({name:"seanlin0800@rmail.com",token:t})}))},logout:function(e){u(e),i(function(){h.transitionTo("login")})}}},213:function(e,t,n){"use strict";function i(){this.generateActions("receiveAll","sendMailSuccess","loginSuccess","loginError","auth","authSuccess","authError","markAllSuccess","markAllCanceled")}var a=n(195);e.exports=a.createActions(i)},214:function(e,t,n){"use strict";var i=n(1),a=n(215),s=n(217),r=n(219),o=i.createClass({displayName:"NewMsgBox",mixins:[a],getInitialState:function(){return this._getStateFromStores()},componentDidMount:function(){this.listenTo(s,this._onChange)},_renderBoxList:function(){var e=this.state.boxKeyList,t=e.length-2;return e.map(function(e,n){return i.createElement(r,{key:e,id:e,isHidden:t>n})})},_getStateFromStores:function(){return{boxKeyList:s.getNewMsgKeys()}},_onChange:function(){this.setState(this._getStateFromStores())},render:function(){return i.createElement("div",{className:"new-message"},this._renderBoxList())}});e.exports=o},215:function(e,t,n){"use strict";var i=n(216),a={componentWillMount:function(){i.create(this)},componentWillUnmount:function(){i.destroy(this)},listenTo:function(e,t){i.add(this,e,t)},listenToMany:function(e,t){e.forEach(function(e){this.listenTo(e,t)},this)},getListeners:function(){return i.listeners(this)}};e.exports=a},216:function(e,t){"use strict";var n={create:function(e){e._AltMixinRegistry=e._AltMixinRegistry||[]},add:function(e,t,n){e._AltMixinRegistry.push(t.listen(n))},destroy:function(e){e._AltMixinRegistry.forEach(function(e){e()}),e._AltMixinRegistry=[]},listeners:function(e){return e._AltMixinRegistry}};e.exports=n},217:function(e,t,n){"use strict";function i(){this.bindActions(s),this.newMsgBoxes={},this.newMsgBoxId=0,this.exportPublicMethods({getNewMsgKeys:function(){return Object.keys(this.getState().newMsgBoxes)}})}var a=n(195),s=n(218);i.prototype.onAddNewMsgBox=function(){this.newMsgBoxes[this.newMsgBoxId++]=1},i.prototype.onDelNewMsgBox=function(e){delete this.newMsgBoxes[e]},e.exports=a.createStore(i,"MsgBoxStore")},218:function(e,t,n){"use strict";function i(){this.generateActions("addNewMsgBox","delNewMsgBox"),this.sendMail=function(e){e.date=(new Date).toISOString(),this.dispatch(),s.sendMail(e)}}var a=n(195),s=n(212);e.exports=a.createActions(i)},219:function(e,t,n){"use strict";var i=n(1),a=n(220),s=n(218),r=n(221),o="New Message",c=i.createClass({displayName:"Model",propTypes:{id:i.PropTypes.string,isHidden:i.PropTypes.bool},getInitialState:function(){return{title:o}},_handleClose:function(){s.delNewMsgBox(this.props.id)},_updateTitle:function(e){this.setState({title:e||o})},_send:function(){s.sendMail(this.refs.form.getInpuValues()),this._handleClose()},render:function(){var e=a({"modal-dialog":!0,box:!0,hidden:this.props.isHidden});return i.createElement("div",{className:e},i.createElement("div",{className:"modal-content"},i.createElement("div",{className:"modal-header"},i.createElement("button",{type:"button",className:"close",onClick:this._handleClose,"aria-label":"Close"},i.createElement("span",{"aria-hidden":"true"},"×")),i.createElement("h4",{className:"modal-title"},this.state.title)),i.createElement("div",{className:"modal-body"},i.createElement(r,{updateHandler:this._updateTitle,ref:"form"})),i.createElement("div",{className:"modal-footer"},i.createElement("button",{type:"button",className:"btn btn-primary",onClick:this._send},"Send"))))}});e.exports=c},221:function(e,t,n){"use strict";var i=n(1),a=n(222),s=i.createClass({displayName:"NewMsgForm",propTypes:{updateHandler:i.PropTypes.func},getInpuValues:function(){var e=i.findDOMNode(this.refs.recipient).value.trim(),t=i.findDOMNode(this.refs.subject).value.trim(),n=i.findDOMNode(this.refs.message).value.trim();return i.findDOMNode(this.refs.recipient).value="",i.findDOMNode(this.refs.subject).value="",i.findDOMNode(this.refs.message).value="",{from:a.USER,to:e,subject:t,body:n}},_update:function(e){this.props.updateHandler(e.target.value)},render:function(){return i.createElement("form",null,i.createElement("div",{className:"form-group"},i.createElement("label",{htmlFor:"recipient",className:"control-label"},"Recipient:"),i.createElement("input",{type:"text",className:"form-control",id:"recipient",ref:"recipient"})),i.createElement("div",{className:"form-group"},i.createElement("label",{htmlFor:"subject",className:"control-label"},"Subject:"),i.createElement("input",{type:"text",className:"form-control",id:"subject",ref:"subject",onBlur:this._update})),i.createElement("div",{className:"form-group"},i.createElement("label",{htmlFor:"message",className:"control-label"},"Message:"),i.createElement("textarea",{className:"form-control",id:"message",rows:"5",ref:"message"})))}});e.exports=s},222:function(e,t){"use strict";e.exports={TITLE:"Rmail",USER:"seanlin0800@rmail.com"}},223:function(e,t,n){"use strict";var i=n(1),a=n(215),s=n(224),r=n(230),o=i.createClass({displayName:"NotificationBox",mixins:[a],componentDidMount:function(){this.listenTo(r,this._onChange)},_onChange:function(){var e={message:r.getMessage(),position:"tc",level:r.getLevel(),action:r.getAction()};this.refs.notificationSystem.addNotification(e)},render:function(){return i.createElement(s,{ref:"notificationSystem"})}});e.exports=o},230:function(e,t,n){"use strict";function i(){this.bindActions(r),this.message="",this.level="sucess",this.action={},this.exportPublicMethods({getMessage:function(){return this.getState().message},getAction:function(){return this.getState().action},getLevel:function(){return this.getState().level}})}var a=n(195),s=n(152),r=n(213),o=n(231),c=function(){};i.prototype.onSendMailSuccess=function(e){this.waitFor([o.dispatchToken]),this.message="Your message has been sent",this.level="success",this.action={label:"View message",callback:function(){s.transitionTo("mails",{name:"sent",id:e.id})}}},i.prototype.onMarkAllSuccess=function(e){this.waitFor([o.dispatchToken]),this.message=e+" messages have been marked as read.",this.level="success",this.action={label:"Ok",callback:c}},i.prototype.onMarkAllCanceled=function(){this.waitFor([o.dispatchToken]),this.message="No unread messages",this.level="error",this.action={label:"Ok",callback:c}},e.exports=a.createStore(i,"NotificationStore")},231:function(e,t,n){"use strict";function i(){this.bindActions(s),this.bindActions(r),this.mailData={},this.exportPublicMethods({getAll:function(){return this.getState().mailData},getBox:function(e){return this.getState().mailData[e]},get:function(e,t){return this.getState().mailData[e].emails[parseInt(t,10)]}})}var a=n(195),s=n(211),r=n(213);i.prototype.onReceiveAll=function(e){var t,n=null,i=e.length;for(t=0;i>t;t++)n=e[t],this.mailData[n.name]||(this.mailData[n.name]=this._convert(n))},i.prototype.onMarkThread=function(e){this._markThread(e)},i.prototype.onMarkAll=function(e){var t,n=this.mailData[e.name].emails;for(t in n)({}).hasOwnProperty.call(n,t)&&(n[t].isRead=e.val)},i.prototype.onDelete=function(e){delete this.mailData[e.name].emails[e.id]},i.prototype.onClickStar=function(e){var t=this._get(this.mailData,e.name,e.id);t.isStarred=e.val},i.prototype.onSendMailSuccess=function(e){this.mailData.sent.emails[e.id]=e},i.prototype._markThread=function(e){var t=this._get(this.mailData,e.name,e.id);t.isRead=e.val},i.prototype._convert=function(e){return{id:e.id,name:e.name,emails:this._toObj(e.emails)}},i.prototype._toObj=function(e){var t,n={},i=e.length;for(t=0;i>t;t++)n[e[t].id]=e[t];return n},i.prototype._get=function(e,t,n){return e[t].emails[n]},e.exports=a.createStore(i,"EmailStore")},232:function(e,t,n){"use strict";var i=n(1),a=n(218),s=n(233),r=i.createClass({displayName:"Sidebar",_clickCompose:function(){a.addNewMsgBox()},render:function(){return i.createElement("div",{className:"col-md-2 sidebar"},i.createElement("button",{type:"button",className:"btn btn-primary btn-block",onClick:this._clickCompose},"COMPOSE"),i.createElement(s,null))}});e.exports=r},233:function(e,t,n){"use strict";var i=n(1),a=n(215),s=n(234),r=n(235),o=i.createClass({displayName:"MailboxList",mixins:[a],getInitialState:function(){return this._getStateFromStores()},componentDidMount:function(){this.listenTo(s,this._onChange)},_getStateFromStores:function(){return{mailboxes:s.getAll()}},_onChange:function(){this.setState(this._getStateFromStores())},render:function(){var e=Object.keys(this.state.mailboxes).map(function(e){return i.createElement(r,{key:this.state.mailboxes[e].id,name:e,unreadCount:this.state.mailboxes[e].unreadCount})}.bind(this));return i.createElement("div",{className:"mailbox-list"},i.createElement("ul",{className:"list-group"},e))}});e.exports=o},234:function(e,t,n){"use strict";function i(){this.bindActions(s),this.bindActions(r),this.boxData={},this.exportPublicMethods({getAll:function(){return this.getState().boxData},get:function(e){return this.getState().boxData[e]}})}var a=n(195),s=n(211),r=n(213),o=n(231);i.prototype.onReceiveAll=function(){var e,t,n;this.waitFor([o.dispatchToken]),e=o.getAll();for(t in e)e.hasOwnProperty(t)&&(n=e[t],this.boxData[n.name]||(this.boxData[n.name]=this._convert(n)))},i.prototype.onMarkThread=function(e){this._updateCount(e.name)},i.prototype.onMarkAll=function(e){this._updateCount(e.name)},i.prototype.onDelete=function(e){this._updateCount(e.name)},i.prototype.onSendMailSuccess=function(){this._updateCount("sent")},i.prototype._convert=function(e){return{id:e.id,unreadCount:this._getUnreadCount(e.emails)}},i.prototype._updateCount=function(e){var t;this.waitFor([o.dispatchToken]),t=o.getBox(e),this.boxData[e].unreadCount=this._getUnreadCount(t.emails)},i.prototype._getUnreadCount=function(e){return Object.keys(e).reduce(function(t,n){return e[n].isRead?t:t+1},0)},e.exports=a.createStore(i,"BoxStore")},235:function(e,t,n){"use strict";var i=n(1),a=n(153),s=n(220),r=n(236),o=i.createClass({displayName:"MailboxTab",propTypes:{name:i.PropTypes.string,unreadCount:i.PropTypes.number},mixins:[a.State,a.Navigation],_handleClick:function(){this.transitionTo("mailboxes",{name:this.props.name})},render:function(){var e=s({"list-group-item":!0,active:this.getParams().name===this.props.name});return i.createElement("li",{className:e,onClick:this._handleClick},i.createElement("span",{className:"badge"},this.props.unreadCount),r.formatBoxName(this.props.name))}});e.exports=o},236:function(e,t,n){"use strict";var i=n(237),a={inbox:"Inbox",spam:"Spam",sent:"Sent Mail"};e.exports={formatBoxName:function(e){return a[e]},formatDate:function(e){var t=i(e),n=i();return n.isSame(t,"day")?t.format("h:mm a"):n.isSame(t,"year")?t.format("MMM DD"):t.format("YYYY/MM/DD")},getUserName:function(){var e=JSON.parse(sessionStorage.getItem("user"));return e.name},isAuth:function(){return!!sessionStorage.getItem("user")}}},323:function(e,t,n){"use strict";var i=n(1),a=n(153),s=a.RouteHandler,r=i.createClass({displayName:"Section",render:function(){return i.createElement("div",{className:"mailbox col-md-10"},i.createElement("div",{className:"panel panel-default"},i.createElement("div",{className:"panel-body"},i.createElement(s,null))))}});e.exports=r},324:function(e,t,n){"use strict";var i=n(1),a=n(325).DropdownButton,s=n(325).MenuItem,r=n(325).Navbar,o=n(325).NavItem,c=n(325).Nav,l=n(467),u=n(222),m=n(236),d=i.createClass({displayName:"Header",_handleLogOut:function(e){e.preventDefault(),l.logout(m.getUserName())},render:function(){return i.createElement(r,{brand:i.createElement("a",{href:"#"},u.TITLE),toggleNavKey:0,fixedTop:!0},i.createElement(c,{right:!0,eventKey:0},i.createElement(a,{title:m.getUserName()},i.createElement(s,{onClick:this._handleLogOut},"Sign out")),i.createElement(o,{href:"https://github.com/seanlin0800/rmail"},"About")))}});e.exports=d},467:function(e,t,n){"use strict";function i(){this.login=function(e){this.dispatch(),s.login(e)},this.logout=function(e){this.dispatch(),s.logout(e)}}var a=n(195),s=n(212);e.exports=a.createActions(i)},468:function(e,t,n){"use strict";var i=n(1),a=n(153),s=a.RouteHandler,r=n(215),o=n(469),c=n(471),l=n(472),u=n(222),m=i.createClass({displayName:"App",mixins:[r],getInitialState:function(){return{isLoading:!0}},componentDidMount:function(){this.listenTo(c,this._onChange)},_onChange:function(){this.setState({isLoading:!1})},_renderHandler:function(){return this.state.isLoading?null:i.createElement(s,null)},render:function(){return i.createElement(o,{title:u.TITLE},i.createElement("div",{className:"main"},this._renderHandler(),i.createElement(l,null)))}});e.exports=m},471:function(e,t,n){"use strict";function i(){this.bindActions(s),this.authStatus={authenticated:!1},this.exportPublicMethods({getStatus:function(){return this.getState().authStatus}})}var a=n(195),s=n(213);i.prototype.onAuthSuccess=function(){this.authStatus.authenticated=!0},i.prototype.onAuthError=function(){this.authStatus.authenticated=!1},e.exports=a.createStore(i,"AuthStore")},472:function(e,t,n){"use strict";var i=n(1),a=n(215),s=n(473),r=n(474),o=i.createClass({displayName:"ProgressBar",mixins:[a],componentDidMount:function(){this.listenTo(r,this._onChange)},_onChange:function(){r.isLoading()?s.start():s.done()},render:function(){return i.createElement("div",null)}});e.exports=o},474:function(e,t,n){"use strict";function i(){this.bindListeners({startLoading:[s.SEND_MAIL,r.LOGIN],stopLoading:[o.SEND_MAIL_SUCCESS,o.LOGIN_SUCCESS,o.LOGIN_ERROR]}),this.loading=!1,this.exportPublicMethods({isLoading:function(){return this.getState().loading}})}var a=n(195),s=n(218),r=n(467),o=n(213);i.prototype.startLoading=function(){this.loading=!0},i.prototype.stopLoading=function(){this.loading=!1},e.exports=a.createStore(i,"ProgressBarStore")},475:function(e,t,n){"use strict";var i=n(1),a=n(153),s=n(215),r=n(467),o=n(476),c=n(222),l=n(236),u=i.createClass({displayName:"Login",mixins:[s,a.Navigation,a.State],statics:{willTransitionTo:function(e){l.isAuth()&&e.redirect("main",{})}},getInitialState:function(){return{error:!1}},componentDidMount:function(){this.listenTo(o,this._onChange)},_onChange:function(){var e=this.getQuery().nextPath||"main";o.isLoggedIn()?this.replaceWith(e):this.setState({error:!0})},_handleLogIn:function(e){var t=i.findDOMNode(this.refs.email).value,n=i.findDOMNode(this.refs.password).value;e.preventDefault(),r.login({email:t,password:n})},_renderErrorMsg:function(){return this.state.error?i.createElement("span",{className:"text-danger"},"The email and password you entered don't match."):null},render:function(){return i.createElement("form",{className:"form-signin",onSubmit:this._handleLogIn},i.createElement("h3",{className:"form-signin-heading text-center"},"Sign in to continue to ",c.TITLE),i.createElement("label",{htmlFor:"inputEmail",className:"sr-only"},"Email address"),i.createElement("input",{type:"email",ref:"email",className:"form-control",placeholder:"Email address",autoFocus:!0}),i.createElement("label",{htmlFor:"inputPassword",className:"sr-only"},"Password"),i.createElement("input",{type:"password",ref:"password",className:"form-control",placeholder:"Password"}),i.createElement("button",{className:"btn btn-primary btn-block",type:"submit"},"Sign in"),i.createElement("p",{className:"text-center"},"(email: seanlin0800@rmail.com password: pass)"),this._renderErrorMsg())}});e.exports=u},476:function(e,t,n){"use strict";function i(){this.bindActions(s),this.bindActions(r),this.user={name:"",authenticated:!1},this.exportPublicMethods({isLoggedIn:function(){return this.getState().user.authenticated},getUser:function(){return this.getState().user}})}var a=n(195),s=n(467),r=n(213),o=n(471);i.prototype.onAuthSuccess=function(e){this.waitFor([o.dispatchToken]),this.user.name=e.name,this.user.authenticated=!0},i.prototype.onLoginSuccess=function(e){this.user.name=e.name,this.user.authenticated=!0,sessionStorage.setItem("user",JSON.stringify(e))},i.prototype.onLoginError=function(){this.user.authenticated=!1},i.prototype.onLogout=function(){this.user.authenticated=!1,sessionStorage.removeItem("user")},e.exports=a.createStore(i,"UserStore")},477:function(e,t,n){"use strict";var i=n(1),a=n(153),s=n(215),r=n(469),o=n(231),c=n(236),l=n(478),u=n(481),m=i.createClass({displayName:"Mailbox",mixins:[a.State,s],getInitialState:function(){return this._getStateFromStores(this.getParams().name)},componentDidMount:function(){this.listenTo(o,this._onChange)},componentWillReceiveProps:function(e){this.setState(this._getStateFromStores(e.params.name))},_getStateFromStores:function(e){var t=o.getBox(e);return{emails:t.emails}},_onChange:function(){this.setState(this._getStateFromStores(this.getParams().name))},render:function(){var e=this.getParams().name;return i.createElement(r,{title:c.formatBoxName(e)},i.createElement("div",null,i.createElement(l,{emails:this.state.emails,boxName:this.getParams().name}),i.createElement(u,{emails:this.state.emails,boxName:this.getParams().name})))}});e.exports=m},478:function(e,t,n){"use strict";var i=n(1),a=n(325).SplitButton,s=n(325).MenuItem,r=n(220),o=n(215),c=n(479),l=n(211),u=n(210),m=n(480),d=i.createClass({displayName:"MailboxToolbar",propTypes:{boxName:i.PropTypes.string,emails:i.PropTypes.object},mixins:[o],getInitialState:function(){return this._getStateFromStores()},componentDidMount:function(){this.listenTo(u,this._onChange)},componentWillReceiveProps:function(e){this.setState({checkedMails:u.getCheckedMails(e.boxName)})},_onChange:function(){this.setState(this._getStateFromStores())},_select:function(e,t){var n,i,a=this.props.emails,s=[];for(n in a)({}).hasOwnProperty.call(a,n)&&(i=!0,e&&a[n][e]!==t&&(i=!1),s.push({id:n,isChecked:i}));return this._createCheckAction.bind(null,s)},_selectNone:function(){this._createCheckAction(this.state.checkedMails.map(function(e){return{id:e,isChecked:!1}}))},_createCheckAction:function(e){l.addCheck({name:this.props.boxName,mailList:e})},_renderCheckBox:function(){var e=Object.keys(this.props.emails).length,t=this.state.checkedMails.length,n=r({"checkbox-content":!0,partial:t>0&&e>t,checked:t>0&&t===e});return i.createElement("div",{className:"checkbox"},i.createElement("div",{className:n}))},_renderButton:function(){var e;return 0===this.state.checkedMails.length?null:(e=m["delete"].bind(null,this.props.boxName),i.createElement("button",{className:"btn btn-danger",onClick:e},i.createElement("span",{className:"glyphicon glyphicon-trash"})))},_getStateFromStores:function(){return{checkedMails:u.getCheckedMails(this.props.boxName)}},render:function(){var e=this.state.checkedMails.length,t=e>0?this._selectNone:this._select(null,!0);return i.createElement("div",{className:"toolbar"},i.createElement(a,{onClick:t,title:this._renderCheckBox()},i.createElement(s,{onClick:this._select(null,!0)},"All"),i.createElement(s,{onClick:this._selectNone},"None"),i.createElement(s,{onClick:this._select("isRead",!0)},"Read"),i.createElement(s,{onClick:this._select("isRead",!1)},"Unread"),i.createElement(s,{onClick:this._select("isStarred",!0)},"Starred"),i.createElement(s,{onClick:this._select("isStarred",!1)},"Unstarred")),this._renderButton(),i.createElement(c,{boxName:this.props.boxName,initMails:this.state.checkedMails}))}});e.exports=d},479:function(e,t,n){"use strict";var i=n(1),a=n(325).SplitButton,s=n(325).MenuItem,r=n(211),o=n(231),c=n(480),l=function(e){return[{name:"read",text:"Mark as read",action:c.markThread.bind(null,e,!0)},{name:"unread",text:"Mark as unread",action:c.markThread.bind(null,e,!1)},{name:"star",text:"Add star",action:c.clickStar.bind(null,e,!0)},{name:"unstar",text:"Remove star",action:c.clickStar.bind(null,e,!1)}]},u=i.createClass({displayName:"ActionButton",propTypes:{boxName:i.PropTypes.string,initMails:i.PropTypes.array},getInitialState:function(){return{checkedMails:this.props.initMails}},componentWillReceiveProps:function(e){this.setState({checkedMails:e.initMails})},_updateMenuMap:function(e,t){var n=!1;return e.read||t.isRead||(e.read=!0,n=!0),!e.unread&&t.isRead&&(e.unread=!0,n=!0),e.star||t.isStarred||(e.star=!0,n=!0),!e.unstar&&t.isStarred&&(e.unstar=!0,n=!0),n},_getMenuMap:function(){var e,t,n,i=this.state.checkedMails.length,a={read:!1,unread:!1,star:!1,unstar:!1};for(t=0;i>t&&(e=o.get(this.props.boxName,this.state.checkedMails[t]),n=this._updateMenuMap(a,e),n);t++);return a},_markAll:function(){r.markAll({name:this.props.boxName,val:!0})},_renderMenuItems:function(){var e,t=this._getMenuMap(),n=l(this.props.boxName),a=[],r=n.length;for(e=0;r>e;e++)t[n[e].name]&&a.push(i.createElement(s,{key:e,onClick:n[e].action},n[e].text));return a},render:function(){return this.state.checkedMails.length>0?i.createElement(a,{title:"More"},this._renderMenuItems()):i.createElement(a,{title:"More"},i.createElement(s,{onClick:this._markAll},"Mark all as read"),i.createElement(s,{divider:!0}),i.createElement("li",{className:"menu-item"},"Select messages to see more actions"))}});e.exports=u},480:function(e,t,n){"use strict";var i=n(211),a=n(210),s=n(231),r={isRead:"markThread",isStarred:"clickStar"},o=function(e,t,n){var o,c,l=a.getCheckedMails(e),u=l.length;for(c=0;u>c;c++)o=s.get(e,l[c]),o[t]!==n&&i[r[t]]({name:e,id:l[c],val:n})};e.exports.markThread=function(e,t){o(e,"isRead",t)},e.exports.clickStar=function(e,t){o(e,"isStarred",t)},e.exports["delete"]=function(e){var t,n=a.getCheckedMails(e),s=n.length;for(t=0;s>t;t++)i["delete"]({name:e,id:n[t]})}},481:function(e,t,n){"use strict";var i=n(1),a=n(215),s=n(208),r=n(482),o=n(483),c=i.createClass({displayName:"EmailList",propTypes:{boxName:i.PropTypes.string,emails:i.PropTypes.object},mixins:[a],getInitialState:function(){return this._getStateFromStores()},componentDidMount:function(){this.listenTo(s,this._onChange)},_getStateFromStores:function(){return{isMenuActive:s.isMenuActive(),menuState:s.getMenuState()}},_renderContextMenu:function(){var e=null;return this.state.isMenuActive&&(e=i.createElement(r,{boxName:this.props.boxName,status:this.state.menuState})),e},_onChange:function(){this.setState(this._getStateFromStores())},render:function(){var e=this.props.emails,t=Object.keys(e).sort(function(e,t){return t-e}),n=t.map(function(t){return i.createElement(o,{key:t,id:t,mail:e[t],boxName:this.props.boxName})}.bind(this));return i.createElement("div",{className:"table-responsive"},i.createElement("table",{className:"email-list table"},i.createElement("tbody",null,n),this._renderContextMenu()))}});e.exports=c},482:function(e,t,n){"use strict";var i=n(1),a=n(194),s=n(231),r=n(210),o=n(480),c=function(e){return function(t){t.stopPropagation(),t.preventDefault(),e(),a.hideMenu()}},l=i.createClass({displayName:"ContextMenu",propTypes:{boxName:i.PropTypes.string,status:i.PropTypes.object},_findReadCheckedMails:function(){var e,t,n=r.getCheckedMails(this.props.boxName),i=n.length;for(t=0;i>t;t++)if(e=s.get(this.props.boxName,n[t]),e.isRead)return!0;return!1},_renderMenuItem:function(){var e=this._findReadCheckedMails(),t=c(o.markThread.bind(null,this.props.boxName,!e));return i.createElement("li",null,i.createElement("a",{href:"#",onClick:t},"Mark as ",e?"unread":"read"))},render:function(){var e={left:this.props.status.xPos,top:this.props.status.yPos},t=c(o["delete"].bind(null,this.props.boxName));return i.createElement("div",{className:"context-menu open",style:e},i.createElement("ul",{className:"dropdown-menu"},this._renderMenuItem(),i.createElement("li",null,i.createElement("a",{href:"#",onClick:t},i.createElement("span",{className:"glyphicon glyphicon-trash"})," Delete"))))}});e.exports=l},483:function(e,t,n){"use strict";var i=n(1),a=n(153),s=n(220),r=n(236),o=n(194),c=n(211),l=n(484),u=n(485),m=i.createClass({displayName:"EmailListItem",propTypes:{mail:i.PropTypes.object,id:i.PropTypes.string,boxName:i.PropTypes.string},mixins:[a.Navigation],_clickThread:function(){this.transitionTo("mails",{name:this.props.boxName,id:this.props.id})},_showContextMenu:function(e){e.preventDefault(),o.showMenu({xPos:e.clientX,yPos:e.clientY,name:this.props.boxName,id:this.props.id}),c.check({name:this.props.boxName,id:this.props.id})},render:function(){var e=s({"mail-item":!0,active:this.props.mail.isRead}),t=s({unread:!this.props.mail.isRead,read:this.props.mail.isRead}),n=this.props.mail.isStarred?"Starred":"Not starred";return i.createElement("tr",{className:e,onClick:this._clickThread,onContextMenu:this._showContextMenu},i.createElement("td",{className:"bg"}),i.createElement("td",{className:"widget"},i.createElement(u,{mail:this.props.mail,boxName:this.props.boxName})),i.createElement("td",{className:"widget",title:n},i.createElement(l,{mail:this.props.mail,boxName:this.props.boxName})),i.createElement("td",{className:"from"},i.createElement("span",{className:t},this.props.mail.from)),i.createElement("td",{className:"subject"},i.createElement("span",{className:t},this.props.mail.subject)," - ",this.props.mail.body.substring(0,50)),i.createElement("td",null,i.createElement("span",{className:t},r.formatDate(this.props.mail.date))))}});e.exports=m},484:function(e,t,n){"use strict";var i=n(1),a=n(220),s=n(211),r=i.createClass({displayName:"StarWidget",propTypes:{mail:i.PropTypes.object,boxName:i.PropTypes.string},_clickHandler:function(e){e.stopPropagation(),s.clickStar({name:this.props.boxName,id:this.props.mail.id,val:!this.props.mail.isStarred})},render:function(){var e=a({star:!0,"star-lit":this.props.mail.isStarred,"star-normal":!this.props.mail.isStarred});return i.createElement("div",{className:e,onClick:this._clickHandler}," ")}});e.exports=r},485:function(e,t,n){"use strict";var i=n(1),a=n(220),s=n(215),r=n(210),o=n(211),c=i.createClass({displayName:"CheckBox",propTypes:{boxName:i.PropTypes.string,mail:i.PropTypes.object},mixins:[s],getInitialState:function(){return this._getStateFromStores(this.props)},componentDidMount:function(){this.listenTo(r,this._onChange)},componentWillReceiveProps:function(e){this.setState(this._getStateFromStores(e))},_onChange:function(){this.setState(this._getStateFromStores(this.props))},_handleClick:function(e){e.stopPropagation(),o.addCheck({name:this.props.boxName,mailList:[{id:this.props.mail.id,isChecked:!this.state.isChecked}]})},_getStateFromStores:function(e){return{isChecked:r.isChecked(e.boxName,e.mail.id)}},render:function(){var e=a({"checkbox-content":!0,checked:this.state.isChecked});return i.createElement("div",{className:"checkbox",onClick:this._handleClick},i.createElement("div",{className:e}))}});e.exports=c},486:function(e,t,n){
"use strict";var i=n(1),a=n(153),s=n(215),r=n(469),o=n(236),c=n(211),l=n(231),u=n(484),m=i.createClass({displayName:"Email",propTypes:{mail:i.PropTypes.object},mixins:[a.State,s],getInitialState:function(){var e=this.getParams().id,t=this.getParams().name;return this._getStateFromStores(t,e)},componentDidMount:function(){this.listenTo(l,this._onChange),this._markRead()},componentWillReceiveProps:function(e){var t=e.params.id,n=e.params.name;this.setState(this._getStateFromStores(n,t))},componentDidUpdate:function(){this._markRead()},_getStateFromStores:function(e,t){return{mail:l.get(e,t)}},_markRead:function(){this.state.mail&&!this.state.mail.isRead&&c.markThread({name:this.getParams().name,id:this.getParams().id,val:!0})},_onChange:function(){this.setState(this._getStateFromStores(this.getParams().name,this.getParams().id))},render:function(){var e=this.state.mail;return e?i.createElement(r,{title:this.state.mail.subject},i.createElement("div",null,i.createElement("h2",null,e.subject),i.createElement("div",{className:"email"},i.createElement("div",{className:"row"},i.createElement("div",{className:"col-md-10"},e.from),i.createElement("div",{className:"col-md-2"},i.createElement(u,{mail:this.state.mail,boxName:this.getParams().name}),o.formatDate(e.date))),i.createElement("div",{className:"to"},"to ",e.to)),i.createElement("div",{className:"body",dangerouslySetInnerHTML:{__html:e.body}}))):null}});e.exports=m},487:function(e,t,n){"use strict";var i=n(1),a={create:function(e){return i.createClass({render:function(){return i.createElement("div",{className:"none-selected alert alert-warning",role:"alert"},i.createElement("span",null,"No ",e," selected."))}})}};e.exports=a},488:function(e,t){"use strict";e.exports={init:function(){sessionStorage.mails||sessionStorage.setItem("mails",JSON.stringify([{id:1,name:"inbox",emails:[{id:1,from:"alice@rmail.com",to:"seanlin0800@rmail.com",subject:"Greeting",body:"Just wanna say hi.",isRead:!1,isStarred:!1,date:"2014-12-29T04:44:44Z"},{id:2,from:"react@facebook.com",to:"seanlin0800@rmail.com",subject:"News Digest",body:'<h1>Awesome React</h1> <img src="https://raw.githubusercontent.com/wiki/facebook/react/react-logo-1000-transparent.png" width=300/)>',isRead:!1,isStarred:!1,date:"2015-04-25T04:44:44Z"},{id:3,from:"admin@github.com",to:"seanlin0800@rmail.com",subject:"Welcome to Github",body:"Welcome!! Thanks for signing up with Github.",isRead:!1,isStarred:!1,date:(new Date).toISOString()}]},{id:2,name:"spam",emails:[{id:3,from:"richdad@gmail.com",to:"seanlin0800@rmail.com",subject:"Want to Be Rich?",body:"Have you ever dreamed of being a millionaire? Here're some secrets rich people don't want you to know.",isRead:!1,isStarred:!1,date:"2015-07-04T16:44:44Z"}]},{id:3,name:"sent",emails:[]}]))}}},489:function(e,t){},498:function(e,t){},500:function(e,t){}});